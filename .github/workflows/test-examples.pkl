// pkl eval --format yaml -o test-examples.yml test-examples.pkl

amends "package://pkg.pkl-lang.org/github.com/jamesward/pklgha/pklgha@0.0.13#/GitHubAction.pkl"
import "package://pkg.pkl-lang.org/github.com/jamesward/pklgha/pklgha@0.0.13#/GitHubAction.pkl"

on {
  push {
    paths {
      "examples"
    }
  }
  pull_request {

  }
}

jobs {
  for (os in List("ubuntu-latest", "windows-latest")) {
    ["test-\(os)"] = new {
      `runs-on` = os

      steps {
        new {
          uses = "actions/checkout@v4"
          with {
            ["submodules"] = "recursive"
            ["token"] = "${{ secrets.API_TOKEN_GITHUB }}"
          }
        }

        GitHubAction.Java.setupJava(null, "21", "sbt")

        new {
          run = "sbt test:compile runMainClassesToleratesFailures"
          `working-directory` = "examples"
        }
      }
    }
  }
}
